{% extends "base.html" %}
{% block title %}Calendar - South Austin Bass Club{% endblock %}
{% block content %}

<!-- Data passed to JavaScript -->
<div id="calendar-data"
     data-current-events="{{ current_event_details_json | e }}"
     data-next-events="{{ next_event_details_json | e }}"
     data-current-year="{{ current_year }}"></div>

<div class="mb-4">
    <h1 class="display-5"><i class="bi bi-calendar3 me-2"></i>Club Calendar</h1>
    <p class="lead text-secondary">Tournament Schedule & Holidays</p>
</div>

<!-- Year Tabs -->
<ul class="nav nav-tabs mb-3" id="yearTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="current-year-tab" data-bs-toggle="tab" data-bs-target="#current-year" type="button" role="tab" aria-controls="current-year" aria-selected="true">
            {{ current_year }}
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="next-year-tab" data-bs-toggle="tab" data-bs-target="#next-year" type="button" role="tab" aria-controls="next-year" aria-selected="false">
            {{ next_year }}
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="yearTabContent">
    <!-- Current Year Tab -->
    <div class="tab-pane fade show active" id="current-year" role="tabpanel" aria-labelledby="current-year-tab">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white text-center">
                <h4 class="mb-0">{{ current_year }} Calendar</h4>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    {% for m in current_calendar_data %}
                    {% set month_num = loop.index %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-light text-center py-1">
                                <small class="fw-bold">{{m[0]}}</small>
                            </div>
                            <div class="card-body p-1">
                                <table class="table table-sm mb-0 small table-dark">
                                    <thead>
                                        <tr>
                                            {% for d in ['S','M','T','W','T','F','S'] %}
                                            <th class="text-center p-0" style="width:14%;">{{d}}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for w in m[1] %}
                                        <tr>
                                            {% for d in w %}
                                            <td class="text-center p-0 {% if '†' in d %}bg-primary text-white calendar-event{% elif '§' in d %}bg-success text-white calendar-event{% elif '‡' in d %}bg-warning text-dark calendar-event{% elif '*' in d %}bg-danger text-white calendar-event{% endif %}"
                                                style="height:20px;line-height:20px;{% if '†' in d or '§' in d or '‡' in d or '*' in d %}cursor:pointer;{% endif %}"
                                                {% if '†' in d or '§' in d or '‡' in d or '*' in d %}
                                                data-year="{{ current_year }}"
                                                data-month="{{ month_num }}"
                                                data-day="{{ d.replace('†','').replace('§','').replace('‡','').replace('*','') }}"
                                                onclick="showEventDetails(this)"
                                                {% endif %}>
                                                {% if d %}{{d.replace('†','').replace('§','').replace('‡','').replace('*','')}}{% endif %}
                                            </td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card-footer text-center">
                <div class="row">
                    {% if 'sabc_tournament' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-primary me-2">&nbsp;</span>SABC Tournaments
                    </div>
                    {% endif %}
                    {% if 'other_tournament' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-warning text-dark me-2">&nbsp;</span>Other Tournaments
                    </div>
                    {% endif %}
                    {% if 'holiday' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-danger me-2">&nbsp;</span>Holidays
                    </div>
                    {% endif %}
                    {% if 'club_event' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-success me-2">&nbsp;</span>Club Events
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Next Year Tab -->
    <div class="tab-pane fade" id="next-year" role="tabpanel" aria-labelledby="next-year-tab">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white text-center">
                <h4 class="mb-0">{{ next_year }} Calendar</h4>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    {% for m in next_calendar_data %}
                    {% set month_num = loop.index %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-light text-center py-1">
                                <small class="fw-bold">{{m[0]}}</small>
                            </div>
                            <div class="card-body p-1">
                                <table class="table table-sm mb-0 small table-dark">
                                    <thead>
                                        <tr>
                                            {% for d in ['S','M','T','W','T','F','S'] %}
                                            <th class="text-center p-0" style="width:14%;">{{d}}</th>
                                            {% endfor %}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for w in m[1] %}
                                        <tr>
                                            {% for d in w %}
                                            <td class="text-center p-0 {% if '†' in d %}bg-primary text-white calendar-event{% elif '§' in d %}bg-success text-white calendar-event{% elif '‡' in d %}bg-warning text-dark calendar-event{% elif '*' in d %}bg-danger text-white calendar-event{% endif %}"
                                                style="height:20px;line-height:20px;{% if '†' in d or '§' in d or '‡' in d or '*' in d %}cursor:pointer;{% endif %}"
                                                {% if '†' in d or '§' in d or '‡' in d or '*' in d %}
                                                data-year="{{ next_year }}"
                                                data-month="{{ month_num }}"
                                                data-day="{{ d.replace('†','').replace('§','').replace('‡','').replace('*','') }}"
                                                onclick="showEventDetails(this)"
                                                {% endif %}>
                                                {% if d %}{{d.replace('†','').replace('§','').replace('‡','').replace('*','')}}{% endif %}
                                            </td>
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card-footer text-center">
                <div class="row">
                    {% if 'sabc_tournament' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-primary me-2">&nbsp;</span>SABC Tournaments
                    </div>
                    {% endif %}
                    {% if 'other_tournament' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-warning text-dark me-2">&nbsp;</span>Other Tournaments
                    </div>
                    {% endif %}
                    {% if 'holiday' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-danger me-2">&nbsp;</span>Holidays
                    </div>
                    {% endif %}
                    {% if 'club_event' in event_types_present %}
                    <div class="col">
                        <span class="badge bg-success me-2">&nbsp;</span>Club Events
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Details Modal -->
<div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalTitle">Event Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="eventModalBody">
                <!-- Event details will be populated here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<script src="/static/calendar.js"></script>

{% endblock %}
