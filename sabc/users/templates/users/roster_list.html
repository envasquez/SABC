{% extends "users/base.html" %}

{% block content %}
    {% include 'components/page_header.html' with title=roster_name subtitle="Club membership directory" icon="people-fill" %}
    
    <div class="row g-4" x-data="rosterSearch()">
        <!-- Search and Filter Controls -->
        <div class="col-12">
            <div class="card shadow-sm bg-light">
                <div class="card-body py-3">
                    <div class="row g-3 align-items-center">
                        <div class="col-12 col-md-6">
                            <div class="input-group">
                                <span class="input-group-text bg-primary text-white">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control" placeholder="Search members..." 
                                       x-model="searchQuery" x-on:input="filterMembers()">
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="d-flex gap-2 flex-wrap">
                                <select class="form-select form-select-sm" x-model="filterType" x-on:change="filterMembers()">
                                    <option value="all">All Members</option>
                                    <option value="officers">Officers Only</option>
                                    <option value="members">Active Members</option>
                                    <option value="guests">Guests Only</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Officers Section -->
        <div class="col-12" x-show="showOfficers()">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-star-fill me-2"></i>Club Officers
                    </h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% if officers %}
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Position</th>
                                        <th>First name</th>
                                        <th>Last name</th>
                                        <th>Profile</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for officer in officers %}
                                        <tr>
                                            <td>{{ officer.position|title }}</td>
                                            <td>{{ officer.angler.user.first_name }}</td>
                                            <td>{{ officer.angler.user.last_name }}</td>
                                            <td>
                                                <a href="{% url 'profile' officer.angler.user.id %}" 
                                                   class="btn btn-outline-primary btn-sm"
                                                   title="View {{ officer.angler.user.get_full_name }}'s profile">
                                                    <i class="bi bi-person"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p class="text-muted">No officers found.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Active Members Section -->
        <div class="col-12" x-show="showMembers()">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-check-circle-fill me-2"></i>Active Members
                    </h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% if members %}
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>First name</th>
                                        <th>Last name</th>
                                        <th>Email</th>
                                        <th>Phone number</th>
                                        <th>Profile</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for member in members %}
                                        <tr>
                                            <td>{{ member.user.first_name }}</td>
                                            <td>{{ member.user.last_name }}</td>
                                            <td>{{ member.user.email }}</td>
                                            <td>{{ member.phone_number.as_national|default:"-" }}</td>
                                            <td>
                                                <a href="{% url 'profile' member.user.id %}" 
                                                   class="btn btn-outline-primary btn-sm"
                                                   title="View {{ member.user.get_full_name }}'s profile">
                                                    <i class="bi bi-person"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <p class="text-muted">No active members found.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Guests Section -->
        {% if guests %}
            <div class="col-12" x-show="showGuests()">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h4 class="mb-0">
                            <i class="bi bi-person-badge me-2"></i>Guest Members
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>First name</th>
                                        <th>Last name</th>
                                        <th>Email</th>
                                        <th>Profile</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for guest in guests %}
                                        <tr>
                                            <td>{{ guest.user.first_name }}</td>
                                            <td>{{ guest.user.last_name }}</td>
                                            <td>{{ guest.user.email }}</td>
                                            <td>
                                                <a href="{% url 'profile' guest.user.id %}" 
                                                   class="btn btn-outline-primary btn-sm"
                                                   title="View {{ guest.user.get_full_name }}'s profile">
                                                    <i class="bi bi-person"></i> View
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
function rosterSearch() {
    return {
        searchQuery: '',
        filterType: 'all',
        
        filterMembers() {
            // Filtering is handled by section visibility
        },
        
        showOfficers() {
            return this.filterType === 'all' || this.filterType === 'officers';
        },
        
        showMembers() {
            return this.filterType === 'all' || this.filterType === 'members';
        },
        
        showGuests() {
            return this.filterType === 'all' || this.filterType === 'guests';
        }
    }
}
</script>
{% endblock %}

{% block extra_css %}
<style>
/* Hide elements properly with Alpine.js */
[x-cloak] {
    display: none !important;
}

/* Ensure tables are properly styled */
.table-responsive {
    overflow-x: auto;
    clear: both;
}

/* Style profile links in tables */
.table .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}

/* FORCE WHITE TEXT ON TABLES - OVERRIDE EVERYTHING */
table.table * {
    color: #ffffff !important;
    font-weight: bold !important;
}

table.table th {
    color: #ffffff !important;
    background-color: rgba(0, 0, 0, 0.3) !important;
    font-weight: bold !important;
    border-color: #666666 !important;
}

table.table td {
    color: #ffffff !important;
    font-weight: 500 !important;
    border-color: #666666 !important;
}

table.table tbody tr {
    background-color: rgba(0, 0, 0, 0.1) !important;
}

table.table tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.2) !important;
}

table.table tbody tr:hover td {
    color: #ffffff !important;
    font-weight: bold !important;
}

/* Override Bootstrap dark theme table styles */
.table-dark, .table-dark th, .table-dark td {
    color: #ffffff !important;
    background-color: transparent !important;
}

/* Make sure no other styles interfere */
.card-body .table * {
    color: #ffffff !important;
}
</style>
{% endblock %}