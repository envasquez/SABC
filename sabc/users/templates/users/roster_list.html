{% extends "users/base.html" %}
{% load table_extras %}
{% load django_tables2 %}

{% block content %}
    {% include 'components/page_header.html' with title=roster_name subtitle="Club membership directory" icon="people-fill" %}
    
    <div class="row g-4" x-data="rosterSearch()">
        <!-- Search and Filter Controls -->
        <div class="col-12">
            <div class="card shadow-sm bg-light">
                <div class="card-body py-3">
                    <div class="row g-3 align-items-center">
                        <div class="col-12 col-md-6">
                            <div class="input-group">
                                <span class="input-group-text bg-sabc-primary text-white">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control" placeholder="Search members..." 
                                       x-model="searchQuery" x-on:input="filterMembers()">
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="d-flex gap-2 flex-wrap">
                                <select class="form-select form-select-sm" x-model="filterType" x-on:change="filterMembers()">
                                    <option value="all">All Members</option>
                                    <option value="officers">Officers Only</option>
                                    <option value="members">Active Members</option>
                                    <option value="guests">Guests Only</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Officers Section -->
        <div class="col-12" x-show="showOfficers()">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-star-fill me-2"></i>Club Officers
                    </h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% render_table o_table %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Active Members Section -->
        <div class="col-12" x-show="showMembers()">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-check-circle-fill me-2"></i>Active Members
                    </h4>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        {% render_table m_table %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Guests Section -->
        {% if g_table %}
            <div class="col-12" x-show="showGuests()">
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h4 class="mb-0">
                            <i class="bi bi-person-badge me-2"></i>Guest Members
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            {% render_table g_table %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
function rosterSearch() {
    return {
        searchQuery: '',
        filterType: 'all',
        
        filterMembers() {
            // Filtering is handled by section visibility
        },
        
        showOfficers() {
            return this.filterType === 'all' || this.filterType === 'officers';
        },
        
        showMembers() {
            return this.filterType === 'all' || this.filterType === 'members';
        },
        
        showGuests() {
            return this.filterType === 'all' || this.filterType === 'guests';
        }
    }
}
</script>
{% endblock %}

{% block extra_css %}
<style>
/* Hide elements properly with Alpine.js */
[x-cloak] {
    display: none !important;
}

/* Ensure tables are properly styled */
.table-responsive {
    overflow-x: auto;
    clear: both;
}

/* Style profile links in tables */
.table .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
}
</style>
{% endblock %}