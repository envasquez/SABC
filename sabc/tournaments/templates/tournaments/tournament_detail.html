{% extends "users/base.html" %}
{% load django_tables2 %}

{% block content %}
    <!-- Tournament Information Section -->
    {% include 'components/tournament_info.html' with tournament=tournament show_actions=true %}
    
    {% if not tournament.complete and tournament.lake %}
        <!-- Pre-Tournament Information -->
        <div class="row g-4 mt-4">
            {% if tournament.description %}
                <div class="col-12 col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-sabc-primary text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-info-circle me-2"></i>Tournament Details
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="article-content">{{ tournament.description|linebreaks }}</div>
                        </div>
                    </div>
                </div>
            {% endif %}
            
            <div class="col-12 {% if tournament.description %}col-lg-4{% endif %}">
                <!-- Tournament Rules Accordion -->
                <div class="accordion shadow-sm" id="tournamentRules">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="payoutHeading">
                            <button class="accordion-button collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#payoutCollapse">
                                <i class="bi bi-currency-dollar me-2 text-success"></i>
                                Entry Fees & Payout
                            </button>
                        </h2>
                        <div id="payoutCollapse" class="accordion-collapse collapse" 
                             data-bs-parent="#tournamentRules">
                            <div class="accordion-body">
                                <div class="mb-3">
                                    <h6 class="text-sabc-primary">Fee Breakdown:</h6>
                                    <div class="small">{{ tournament.payout_multiplier.fee_breakdown|linebreaks }}</div>
                                </div>
                                <div>
                                    <h6 class="text-sabc-primary">Payout Structure:</h6>
                                    <div class="small">{{ tournament.rules.payout|linebreaks }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="bigBassHeading">
                            <button class="accordion-button collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#bigBassCollapse">
                                <i class="bi bi-award me-2 text-warning"></i>
                                Big Bass Pot
                            </button>
                        </h2>
                        <div id="bigBassCollapse" class="accordion-collapse collapse" 
                             data-bs-parent="#tournamentRules">
                            <div class="accordion-body small">
                                {{ tournament.rules.big_bass_breakdown|linebreaks }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="weighInHeading">
                            <button class="accordion-button collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#weighInCollapse">
                                <i class="bi bi-scale me-2 text-primary"></i>
                                Weigh-In Procedures
                            </button>
                        </h2>
                        <div id="weighInCollapse" class="accordion-collapse collapse" 
                             data-bs-parent="#tournamentRules">
                            <div class="accordion-body small">
                                {{ tournament.rules.weigh_in|linebreaks }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="rulesHeading">
                            <button class="accordion-button collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#rulesCollapse">
                                <i class="bi bi-list-check me-2 text-sabc-primary"></i>
                                Tournament Rules
                            </button>
                        </h2>
                        <div id="rulesCollapse" class="accordion-collapse collapse" 
                             data-bs-parent="#tournamentRules">
                            <div class="accordion-body">
                                <div class="mb-3 small">{{ tournament.rules.rules|linebreaks }}</div>
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <strong>Dead Fish Penalty:</strong> {{ tournament.rules.dead_fish_penalty }}lb per fish
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    
    <!-- Tournament Results Section -->
    {% if tournament.complete %}
        <div class="mt-5">
            <div class="d-flex align-items-center mb-4">
                <i class="bi bi-trophy-fill text-warning fs-2 me-3"></i>
                <div>
                    <h2 class="text-sabc-primary mb-1">Tournament Results</h2>
                    <p class="text-muted mb-0">Final standings and statistics</p>
                </div>
            </div>
            
            <!-- Results Tables -->
            <div class="row g-4">
                {% if user.is_staff %}
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-cash-stack me-2"></i>Payouts
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    {% render_table payouts %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-sabc-primary text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-bar-chart me-2"></i>Tournament Statistics
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                {% render_table catch_stats %}
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if is_team_tournament and render_team_results %}
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-sabc-water text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-people-fill me-2"></i>Team Results
                                    <span class="badge bg-light text-dark ms-2">Primary Standings</span>
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    {% if user.is_staff %}
                                        {% render_table editable_team_results %}
                                    {% else %}
                                        {% render_table team_results %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-sabc-accent text-white">
                            <h5 class="mb-0">
                                <i class="bi bi-person-fill me-2"></i>Individual Results
                                {% if not is_team_tournament %}
                                    <span class="badge bg-light text-dark ms-2">Primary Standings</span>
                                {% else %}
                                    <span class="badge bg-secondary ms-2">For Annual Awards</span>
                                {% endif %}
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                {% if user.is_staff %}
                                    {% render_table editable_results %}
                                {% else %}
                                    {% render_table results %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if not is_team_tournament and render_team_results %}
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-sabc-water text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-people-fill me-2"></i>Team Results
                                    <span class="badge bg-secondary ms-2">For Reference</span>
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    {% if user.is_staff %}
                                        {% render_table editable_team_results %}
                                    {% else %}
                                        {% render_table team_results %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                {% if render_buy_ins %}
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-warning text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-credit-card me-2"></i>Buy-ins
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    {% if user.is_staff %}
                                        {% render_table editable_buy_ins %}
                                    {% else %}
                                        {% render_table buy_ins %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                {% if render_dqs %}
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-exclamation-triangle me-2"></i>Disqualifications
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    {% if user.is_staff %}
                                        {% render_table editable_dqs %}
                                    {% else %}
                                        {% render_table dqs %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
{% endblock content %}
